name: poc-yaml-pega-infinity-cve-2021-27651-unauth
manual: true
transport: http
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /prweb/PRAuth/app/default/
            follow_redirects: true
        expression: response.status == 200 && response.headers["Set-Cookie"].contains("Pega-RULES") && response.body_string.contains("Pega Infinity") && "<span>Pega [0-9.]+?</span>".matches(response.body_string)
        output:
            search: '"<span>Pega (?P<version1>[0-9]).(?P<version2>[0-9]).(?P<version3>[0-9])</span>".submatch(response.body_string)'
            version1: search["version1"]
            version2: search["version2"]
            version3: search["version3"]
            version: int(version1 + version2 + version3)
    r1:
        request:
            cache: true
            method: GET
            path: /
        expression: response.status == 200 && version >= 821 && version < 852
expression: r0() && r1()
detail:
    author: Editor
    links:
        - https://github.com/samwcyo/CVE-2021-27651-PoC/blob/main/RCE.md
    vulnerability:
        id: CT-151752
        level: critical
